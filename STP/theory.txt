Устранение петель с помощью протокола STP

Коммутационная петля. Создаваемые проблемы:
1. Широковещательные штормы
2. Множественные копии кадров
3. Множественные петли

Spanning Tree Protocol (STP) - Протокол связующего дерева
- Протокол 2-го уровня модели OSI
- Защита от петель в сети
- Автоматическое резервирование каналов
- Время сходимости 30-50 секунд 
Альтернативы: RSTP, MSTP (менее секунды)

Алгоритм работы:
Пример: Соеденены три коммутатора. 
     SW1
SW2       SW3
ПС SW1-SW2 = 100 мб/с, ПС SW1-SW3 = 10 мб/с, ПС SW2-SW3 = 10 мб/с
1. Выбирается корневой коммутатор (Root Bridge)
- Его designated порты переходят в режим передачи (все порты принимают и отправляют пакеты)
Выбираем SW1
2. Выбирается корневой порт на некорневом коммутаторе
- Корневой порт переходит в режим передачи (расчитывается стоимость пути от некорневого коммутатора до корневого)
- Чем больше пропускная способность канала, тем меньше стоимость
Корневой порт в SW2 смотрит на SW3, в SW3 смотрит на SW1
3. Выбор назначенного порта
- В каждом сегменте - одном куске витой пары выбирается назначенный порт
- Назначенный порт выбирается на коммутаторе, который имеет наименьшую стоимость пути до корневого коммутатора.
- Назначенный порт переходит в состояние передачи
В cегменте SW2-SW3 назначенный порт выбирается на SW3

Как выбирается корневой коммутатор?
Исходя из приоритета и MAC-адреса
Так как на всех коммутаторах cisco по умолчанию одинаковый приоритет,
то корневым становится коммутатор с наименьшим MAC-адресом

Также происходит и выбор назначенного порта,
в случае если у двух коммутаторов одинаковая стоимость до корневого коммутатора

Состояния портов:
1. Блокировка (blocking)
2. Прослушивание (listening)
3. Обучение (learning)
4. Передача (forwarding)
